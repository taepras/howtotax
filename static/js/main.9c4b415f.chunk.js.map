{"version":3,"sources":["components/D3Component.jsx","App.js","reportWebVitals.js","index.js"],"names":["SvgContainer","styled","div","Fade","CartesianSvg","svg","D3Component","income","expense","allowance","taxBrackets","padding","left","right","top","bottom","isPullTax","transitionTime","enableTransition","useDimensions","onResize","observe","unobserve","width","height","entry","transitionDuration","useMemo","d3Container","useRef","cleanedExpense","Math","max","cleanedAllowance","netIncome","scaleIncome","useCallback","d3","domain","range","barWidth","scaleTaxRate","axisIncomeLeft","tickFormat","axisIncomeRight","axisTaxRate","useLayoutEffect","current","select","attr","transition","duration","style","console","log","text","bracketLineGroups","selectAll","data","bracketLineGroupsEnter","enter","append","classed","merge","d","taxRate","minNetIncome","maxNetIncome","toString","replace","i","taxParts","taxPartsEnter","taxCamouflageParts","taxCamouflagePartsEnter","call","ref","id","className","transform","fill","fontSize","alignmentBaseline","textAnchor","fillOpacity","ChartContainer","PageContainer","ControlsContainer","InputGroup","App","useState","setIncome","setExpense","setAllowance","setPullTax","taxFinal","sumTax","remainingNetIncome","bracketRange","min","type","step","value","onChange","e","target","toFixed","gridColumn","onClick","display","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.9c4b415f.chunk.js","sourcesContent":["import React, { useRef, useEffect, useLayoutEffect, useMemo, useCallback, useState } from 'react';\r\nimport * as d3 from 'd3';\r\n// import { transition } from 'd3';\r\nimport useDimensions from \"react-cool-dimensions\";\r\nimport styled from 'styled-components';\r\nimport { useResizeDetector } from 'react-resize-detector';\r\n\r\n\r\nconst SvgContainer = styled.div`\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    right: 0;\r\n    bottom: 0;\r\n`\r\n\r\nconst Fade = styled.div`\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    right: 0;\r\n    height: 20%;\r\n    background: linear-gradient(to bottom, #222, #2220);\r\n`\r\n\r\nconst CartesianSvg = styled.svg`\r\n    & > g text {\r\n        transform: scale(1, -1);\r\n    }\r\n`\r\n\r\n// const transitionDuration = 1000\r\n\r\nexport const D3Component = ({\r\n    income,\r\n    expense,\r\n    allowance,\r\n    taxBrackets,\r\n    // width = 800,\r\n    // height = 500,\r\n    padding = {\r\n        left: 35,\r\n        right: 0,\r\n        top: 0,\r\n        bottom: 50,\r\n    },\r\n    isPullTax = false,\r\n    transitionTime = 500,\r\n    enableTransition = true\r\n}) => {\r\n    const { observe, unobserve, width, height, entry } = useDimensions({\r\n        onResize: ({ observe, unobserve, width, height, entry }) => {\r\n            // Triggered whenever the size of the target is changed...\r\n\r\n            unobserve(); // To stop observing the current target element\r\n            observe(); // To re-start observing the current target element\r\n        },\r\n    });\r\n\r\n    const transitionDuration = useMemo(() => enableTransition ? transitionTime : 0, [enableTransition, transitionTime]);\r\n\r\n    // const { width, height, chartContainer } = useResizeDetector();\r\n\r\n    const d3Container = useRef(null);\r\n\r\n    // const { observe, unobserve, width, height, entry } = useDimensions({\r\n    //     onResize: ({ observe, unobserve, width, height, entry }) => {\r\n    //         // Triggered whenever the size of the target is changed...\r\n\r\n    //         unobserve(); // To stofp observing the current target element\r\n    //         observe(); // To re-start observing the current target element\r\n    //     },\r\n    // });\r\n\r\n    // const height = d3Container.current.clientHeight;\r\n    // const width = d3Container.current.clientWidth\r\n    // const [width, setWidth] = useState(0)\r\n    // const [height, setHeight] = useState(0)\r\n\r\n    // useLayoutEffect(() => {\r\n    //     if (d3Container.current) {\r\n    //         setWidth(d3Container.current.parentElement.offsetWidth);\r\n    //         setHeight(d3Container.current.parentElement.offsetHeight);\r\n    //     }\r\n    // }, [d3Container])\r\n\r\n    const cleanedExpense = useMemo(() => expense < (income - allowance) ? +expense : +Math.max(0, income - allowance), [income, expense]);\r\n    const cleanedAllowance = useMemo(() => allowance < income ? +allowance : +income, [income, allowance]);\r\n\r\n    const netIncome = useMemo(() => {\r\n        return Math.max(income - expense - allowance, 0);\r\n    }, [income, expense, allowance]);\r\n\r\n    const scaleIncome = useCallback(\r\n        d3.scaleLinear()\r\n            .domain([0, Math.max(300_000, income * 1.4)])\r\n            .range([0, height - padding.bottom])\r\n        , [height, income, padding])\r\n\r\n    const barWidth = useMemo(() => width - (padding.left + padding.right), [width, padding]);\r\n\r\n    const scaleTaxRate = useCallback(\r\n        d3.scaleLinear()\r\n            .domain([0, 1])\r\n            .range([0, barWidth])\r\n        , [income, width])\r\n\r\n    const axisIncomeLeft = useMemo(() => d3.axisLeft(scaleIncome)\r\n        .tickFormat(d3.format(\".3s\"))\r\n        , [scaleIncome]);\r\n    const axisIncomeRight = useMemo(() => d3.axisRight(scaleIncome), [scaleIncome]);\r\n    const axisTaxRate = useMemo(() => d3.axisBottom(scaleTaxRate).tickFormat(d3.format('.0%'))\r\n        , [scaleTaxRate]);\r\n\r\n    const numberWithCommas = (x) => x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\")\r\n\r\n    useLayoutEffect(() => {\r\n        if (d3Container.current) {\r\n\r\n            // console.log(d3Container.current);\r\n\r\n\r\n            // const boundingRect = d3Container.current.getClientBoundingRect();\r\n\r\n            const svg = d3.select(d3Container.current);\r\n\r\n            svg.select('g.container')\r\n                .attr('transform', `translate(${padding.left}, ${padding.bottom})`);\r\n\r\n            svg.select('rect.net-income')\r\n                .attr('width', barWidth)\r\n                .transition().duration(transitionDuration)\r\n                .style('fill', '#08f')\r\n                .attr('height', Math.max(0, scaleIncome(netIncome)));\r\n\r\n            console.log('netIncome + cleanedAllowance', netIncome + cleanedAllowance, cleanedAllowance, scaleIncome(cleanedAllowance))\r\n            svg.select('rect.expense')\r\n                .attr('width', barWidth)\r\n                .transition().duration(transitionDuration)\r\n                .style('fill', '#135')\r\n                .attr('y', scaleIncome(netIncome + cleanedAllowance))\r\n                .attr('height', Math.max(0, scaleIncome(cleanedExpense)));\r\n\r\n            svg.select('rect.allowance')\r\n                .attr('width', barWidth)\r\n                .transition().duration(transitionDuration)\r\n                .style('fill', '#147')\r\n                .attr('y', scaleIncome(netIncome))\r\n                .attr('height', Math.max(0, scaleIncome(cleanedAllowance)));\r\n\r\n            svg.select('text.net-income-text')\r\n                .text(`เงินได้สุทธิ`)// ${numberWithCommas(netIncome)} บาท`)\r\n                .attr('x', barWidth / 2)\r\n                .attr('y', -scaleIncome(netIncome / 2));\r\n\r\n            svg.select('text.net-expense-text')\r\n                .text(`ค่าลดหย่อน`)// ${numberWithCommas(allowance)} บาท`)\r\n                .attr('x', barWidth / 2)\r\n                .attr('y', -scaleIncome(netIncome + cleanedAllowance / 2));\r\n\r\n            svg.select('text.net-allowance-text')\r\n                .text(`ค่าใช้จ่าย`)// ${numberWithCommas(expense)} บาท`)\r\n                .attr('x', barWidth / 2)\r\n                .attr('y', -scaleIncome(income - expense / 2));\r\n\r\n\r\n\r\n            const bracketLineGroups = svg.select('g.tax-lines')\r\n                .selectAll('g')\r\n                .data(taxBrackets)\r\n\r\n            const bracketLineGroupsEnter = bracketLineGroups\r\n                .enter()\r\n                .append('g')\r\n                .classed('bracket', true)\r\n\r\n            bracketLineGroupsEnter.append('text').classed('bracket-rate-text', true)\r\n            bracketLineGroupsEnter.append('text').classed('bracket-min-text', true)\r\n            bracketLineGroupsEnter.append('rect').classed('bracket-rect', true)\r\n            bracketLineGroupsEnter.append('line').classed('bracket-line', true)\r\n\r\n            // bracketTextEnter\r\n            //     .append('text')\r\n            //     .text(d => `อัตราภาษี ${d.taxRate * 100}%\\nเริ่มที่เงินได้ ${d.minNetIncome}`)\r\n            // bracketTextEnter\r\n            //     .append('text')\r\n            //     .text(d => `อัตราภาษี ${d.taxRate * 100}%\\nเริ่มที่เงินได้ ${d.minNetIncome}`)\r\n\r\n            bracketLineGroups.merge(bracketLineGroupsEnter)\r\n                .select('rect')\r\n                .attr('x', 0)   // d => scaleTaxRate(d.taxRate))\r\n                .attr('width', d => scaleTaxRate(d.taxRate))\r\n                .style('fill-opacity', 0)\r\n                .style('stroke', '#f80')\r\n                .style(\"stroke-dasharray\", \"3, 3\")\r\n                .transition().duration(transitionDuration)\r\n                .attr('y', d => scaleIncome(d.minNetIncome))\r\n                .attr('height', d => scaleIncome(d.maxNetIncome - d.minNetIncome))\r\n\r\n            bracketLineGroups.merge(bracketLineGroupsEnter)\r\n                .select('line')\r\n                .attr('x1', 0)\r\n                .attr('x2', barWidth)\r\n                .style('stroke', '#f80')\r\n                .style(\"stroke-dasharray\", \"3, 3\")\r\n                .transition().duration(transitionDuration)\r\n                // .style('stroke-opacity', '0.4')\r\n                .attr('y1', d => scaleIncome(d.maxNetIncome))\r\n                .attr('y2', d => scaleIncome(d.maxNetIncome))\r\n\r\n            bracketLineGroups.merge(bracketLineGroupsEnter)\r\n                .select('text.bracket-rate-text')\r\n                .style('fill', '#fff')\r\n                .style('font-size', '0.75rem')\r\n                .style('text-anchor', 'end')\r\n                .attr('x', barWidth - 5)\r\n                .transition().duration(transitionDuration)\r\n                .text(d => `เริ่มคิดที่ ${numberWithCommas(d.minNetIncome)} บาท`)\r\n                .style('fill-opacity', (d, i) => i != 0 && scaleIncome(d.maxNetIncome - d.minNetIncome) > 20 ? 1 : 0)\r\n                .attr('y', d => -scaleIncome(d.minNetIncome) - 5)\r\n\r\n            bracketLineGroups.merge(bracketLineGroupsEnter)\r\n                .select('text.bracket-min-text')\r\n                .style('fill', '#fff')\r\n                .style('font-size', '0.75rem')\r\n                .attr('x', d => scaleTaxRate(d.taxRate) + 5)\r\n                .transition().duration(transitionDuration)\r\n                .text(d => `ภาษี ${d.taxRate * 100}%`)\r\n                // .text(d => scaleIncome(d.maxNetIncome - d.minNetIncome) > 150\r\n                //     ? `เริ่มคิดที่ ${numberWithCommas(d.minNetIncome)} บาท`\r\n                //     : `${d.taxRate * 100}%`)\r\n                .style('fill-opacity', (d, i) => i != 0 && scaleIncome(d.maxNetIncome - d.minNetIncome) > 20 ? 1 : 0)\r\n                .attr('y', d => -scaleIncome(d.minNetIncome) - 5)\r\n\r\n\r\n\r\n            const taxParts = svg.select('g.tax-parts')\r\n                .selectAll('rect')\r\n                .data(taxBrackets)\r\n\r\n            const taxPartsEnter = taxParts\r\n                .enter()\r\n                .append('rect')\r\n                .style('fill', '#f80')\r\n                .style('fill-opacity', 1)\r\n\r\n            taxParts.merge(taxPartsEnter)\r\n                .attr('x', 0)   // d => scaleTaxRate(d.taxRate))\r\n                .attr('width', d => scaleTaxRate(d.taxRate))\r\n                .transition().duration(transitionDuration)\r\n                .attr('y', d => scaleIncome(d.minNetIncome))\r\n                .attr('height', d => {\r\n                    if (netIncome > d.minNetIncome) {\r\n                        if (netIncome < d.maxNetIncome)\r\n                            return scaleIncome(netIncome - d.minNetIncome)\r\n                        else\r\n                            return scaleIncome(d.maxNetIncome - d.minNetIncome);\r\n                    } else {\r\n                        return 0;\r\n                    }\r\n                })\r\n\r\n            console.log(isPullTax);\r\n            svg.select('g.tax-parts')\r\n                .transition(transitionDuration)\r\n                .attr('transform', isPullTax ? `translate(${-50}, 0)` : 'translate(0, 0)')\r\n                .style('opacity', isPullTax ? 0 : 1);\r\n\r\n\r\n            const taxCamouflageParts = svg.select('g.tax-camouflage')\r\n                .selectAll('rect')\r\n                .data(taxBrackets)\r\n\r\n            const taxCamouflagePartsEnter = taxCamouflageParts\r\n                .enter()\r\n                .append('rect')\r\n                .style('fill', '#222')\r\n                .style('stroke', '#222')\r\n                .style('fill-opacity', 1)\r\n\r\n            taxCamouflageParts.merge(taxCamouflagePartsEnter)\r\n                .attr('x', 0)   // d => scaleTaxRate(d.taxRate))\r\n                .attr('width', d => scaleTaxRate(d.taxRate))\r\n                .transition().duration(transitionDuration)\r\n                .attr('y', d => scaleIncome(d.minNetIncome))\r\n                .attr('height', d => {\r\n                    if (netIncome > d.minNetIncome) {\r\n                        if (netIncome < d.maxNetIncome)\r\n                            return scaleIncome(netIncome - d.minNetIncome)\r\n                        else\r\n                            return scaleIncome(d.maxNetIncome - d.minNetIncome);\r\n                    } else {\r\n                        return 0;\r\n                    }\r\n                })\r\n\r\n\r\n            // AXES\r\n\r\n            d3.select(\"g.axis-income-bottom\")\r\n                .attr(\"transform\", `translate(0, 0)`)\r\n                .transition().duration(transitionDuration)\r\n                .call(axisIncomeLeft);\r\n\r\n            // d3.select(\"g.axis-income-top\")\r\n            //     .attr(\"transform\", `translate(0, -10)`)\r\n            //     .transition().duration(transitionDuration)\r\n            //     .call(axisIncomeTop);\r\n\r\n            d3.select(\"g.axis-tax-rate\")\r\n                // .attr(\"transform\", `translate(-10, 0)`)\r\n                .transition().duration(transitionDuration)\r\n                .call(axisTaxRate);\r\n\r\n            // var squareDim = 10; // pixel dimensions of square\r\n            // var boxesPerRow = 15;\r\n\r\n            // const boxesGroups = svg\r\n            //     .selectAll('g.box')\r\n            //     .data(d3Data, (d, i) => i)\r\n\r\n            // const boxesGroupsEnter = boxesGroups\r\n            //     .enter()\r\n            //     .append('g')\r\n            //     .classed('box', true)\r\n            //     .attr('id', (d, i) => `box-${i}`)\r\n            //     .attr('transform', (d, i) => {\r\n            //         let x = Math.floor(i / boxesPerRow) * (squareDim + 2);\r\n            //         let y = Math.floor(i % boxesPerRow) * (squareDim + 2);\r\n            //         return `translate(${x}, ${y})`;\r\n            //     });\r\n\r\n            // boxesGroupsEnter\r\n            //     .append('rect')\r\n            //     .classed('box-rect', true)\r\n            //     .style('fill', '#c62828')\r\n\r\n            // boxesGroups.merge(boxesGroupsEnter)\r\n            //     .attr('data-box-amount', d => d)\r\n\r\n            // boxesGroups.merge(boxesGroupsEnter)\r\n            //     .select('rect.box-rect')\r\n            //     .attr('data-box-amount', d => d)\r\n            //     .attr('width', squareDim)\r\n            //     .attr('height', d => squareDim * (d / amountPerBox))\r\n\r\n            // console.log(d3Data)\r\n            // boxesGroups.exit().remove();\r\n            // boxGroups.exit().remove();\r\n        }\r\n    }, [\r\n        width, height,\r\n        d3Container,\r\n        isPullTax,\r\n        barWidth,\r\n        scaleIncome,\r\n        netIncome,\r\n        income,\r\n        expense,\r\n        allowance,\r\n        taxBrackets,\r\n        padding,\r\n        axisIncomeLeft,\r\n        axisIncomeRight,\r\n        axisTaxRate,\r\n        cleanedAllowance,\r\n        cleanedExpense,\r\n        scaleTaxRate\r\n    ]);\r\n\r\n    return (<>\r\n        <SvgContainer ref={observe}>\r\n            <Fade />\r\n            <CartesianSvg\r\n                id=\"chart\"\r\n                className=\"d3-component\"\r\n                width={width}\r\n                height={height}\r\n                ref={d3Container}\r\n            // viewBox={`0 0 ${width} ${height}`}\r\n            >\r\n                <g transform={`translate(0, ${height}) scale(1, -1)`}>\r\n                    <g className=\"container\">\r\n                        <rect className=\"net-income\" />\r\n                        <rect className=\"expense\" />\r\n                        <rect className=\"allowance\" />\r\n                        <text className=\"net-income-text\" style={{\r\n                            fill: '#fff', fontSize: '0.75rem', alignmentBaseline: 'middle', textAnchor: 'middle', fillOpacity: 0.4\r\n                        }} />\r\n                        <text className=\"net-expense-text\" style={{\r\n                            fill: '#fff', fontSize: '0.75rem', alignmentBaseline: 'middle', textAnchor: 'middle', fillOpacity: 0.4\r\n                        }} />\r\n                        <text className=\"net-allowance-text\" style={{\r\n                            fill: '#fff', fontSize: '0.75rem', alignmentBaseline: 'middle', textAnchor: 'middle', fillOpacity: 0.4\r\n                        }} />\r\n                        <g className=\"tax-lines\" />\r\n                        <g className=\"tax-camouflage\" />\r\n                        <g className=\"axis-income-top\" />\r\n                        <g className=\"axis-income-bottom\" />\r\n                        <g className=\"axis-tax-rate\" />\r\n                        <g className=\"tax-parts\" />\r\n                    </g>\r\n                </g>\r\n            </CartesianSvg>\r\n        </SvgContainer>\r\n    </>);\r\n}","import { useMemo, useState } from \"react\";\nimport { D3Component } from \"./components/D3Component\";\nimport styled from \"styled-components\";\nimport \"./App.css\";\n\nconst ChartContainer = styled.div`\n  /* padding: 30px; */\n  width: 100%;\n  /* height: 50vh; */\n  flex: 1;\n  position: relative;\n`;\n\nconst PageContainer = styled.div`\n  padding: 30px;\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  display: flex;\n  flex-direction: column;\n\n  @media (min-width: 768px) {\n    flex-direction: row;\n    padding: 50px;\n  }\n`;\n\nconst ControlsContainer = styled.div`\n  /* margin-top: 30px; */\n  display: grid;\n  grid-template-columns: 30% auto;\n  column-gap: 10px;\n  row-gap: 15px;\n  flex-direction: column;\n  margin-bottom: 30px;\n  align-content: center;\n\n  @media (min-width: 768px) {\n    margin-left: 80px;\n    width: 400px;\n    max-width: 40%;\n  }\n`;\n\nconst InputGroup = styled.div`\n  /* margin-bottom: 10px; */\n  display: flex;\n  flex-direction: column;\n`;\n\nfunction App() {\n  const [income, setIncome] = useState(480000);\n  const [expense, setExpense] = useState(100000);\n  const [allowance, setAllowance] = useState(60000);\n\n  const netIncome = useMemo(() => {\n    return income - expense - allowance;\n  }, [income, expense, allowance]);\n\n  const [isPullTax, setPullTax] = useState(false);\n\n  const taxBrackets = [\n    {\n      minNetIncome: 0,\n      maxNetIncome: 150000,\n      taxRate: 0,\n    },\n    {\n      minNetIncome: 150000,\n      maxNetIncome: 300000,\n      taxRate: 0.05,\n    },\n    {\n      minNetIncome: 300000,\n      maxNetIncome: 500000,\n      taxRate: 0.1,\n    },\n    {\n      minNetIncome: 500000,\n      maxNetIncome: 750000,\n      taxRate: 0.15,\n    },\n    {\n      minNetIncome: 750000,\n      maxNetIncome: 1000000,\n      taxRate: 0.2,\n    },\n    {\n      minNetIncome: 1000000,\n      maxNetIncome: 2000000,\n      taxRate: 0.25,\n    },\n    {\n      minNetIncome: 2000000,\n      maxNetIncome: 5000000,\n      taxRate: 0.3,\n    },\n    {\n      minNetIncome: 5000000,\n      maxNetIncome: 999999999999,\n      taxRate: 0.35,\n    },\n  ];\n\n  const taxFinal = useMemo(() => {\n    let sumTax = 0;\n    let remainingNetIncome = netIncome;\n    for (let i in taxBrackets) {\n      let bracketRange =\n        taxBrackets[i].maxNetIncome - taxBrackets[i].minNetIncome;\n      let incomeInBracket = Math.min(remainingNetIncome, bracketRange);\n      let taxInBracket = incomeInBracket * taxBrackets[i].taxRate;\n      sumTax += taxInBracket;\n      remainingNetIncome -= bracketRange;\n      if (remainingNetIncome <= 0) break;\n    }\n    return sumTax;\n  }, [netIncome]);\n\n  return (\n    <PageContainer>\n      <ChartContainer>\n        <D3Component\n          income={income}\n          expense={expense}\n          allowance={allowance}\n          taxBrackets={taxBrackets}\n          isPullTax={isPullTax}\n        />\n      </ChartContainer>\n      <ControlsContainer>\n        <label>รายได้</label>\n        <InputGroup>\n          <input\n            type=\"number\"\n            step={10000}\n            min={0}\n            value={income}\n            onChange={(e) => setIncome(e.target.value)}\n          />\n          <input\n            type=\"range\"\n            min=\"0\"\n            max=\"10000000\"\n            value={income}\n            onChange={(e) => setIncome(e.target.value)}\n          />\n        </InputGroup>\n\n        <label>ค่าใช้จ่าย</label>\n        <InputGroup>\n          <input\n            type=\"number\"\n            step={10000}\n            min={0}\n            value={expense}\n            onChange={(e) => setExpense(e.target.value)}\n          />\n          <input\n            type=\"range\"\n            min=\"0\"\n            max=\"1000000\"\n            value={expense}\n            onChange={(e) => setExpense(e.target.value)}\n          />\n        </InputGroup>\n\n        <label>ค่าลดหย่อน</label>\n        <InputGroup>\n          <input\n            type=\"number\"\n            step={10000}\n            min={0}\n            value={allowance}\n            onChange={(e) => setAllowance(e.target.value)}\n          />\n          <input\n            type=\"range\"\n            min=\"0\"\n            max=\"1000000\"\n            value={allowance}\n            onChange={(e) => setAllowance(e.target.value)}\n          />\n        </InputGroup>\n\n        <div>เงินได้สุทธิ</div>\n        <div>{netIncome}</div>\n        <div>ภาษีที่ต้องเสีย</div>\n        <div>\n          {taxFinal}<br/>\n          <small>คิดเป็น <b>{((taxFinal / income) * 100).toFixed(1)}%</b> ของรายได้ทั้งหมด</small>\n        </div>\n        <div style={{ gridColumn: \"1 / 3\" }}>\n          <button\n            onClick={() => setPullTax(!isPullTax)}\n            style={{ display: 'block', width: '100%', gridColumn: \"1 / 3\" }}\n          >\n            Tax\n          </button>\n        </div>\n      </ControlsContainer>\n    </PageContainer>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}